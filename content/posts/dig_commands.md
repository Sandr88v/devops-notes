---
title: "Dig_commands"
date: 2024-03-31T20:57:53+03:00
slug: dig_commands
aliases:
  - dig_commands
weight: 10010
toc_hide: true
tags:
  - linux
---

Команды DIG предлагают огромное количество функций и различных опций. Они являются одними из самых популярных и предпочтительных инструментов для сетевых администраторов.
Команда DIG (команда Domain Information Groper) — это сетевой инструмент с базовым интерфейсом командной строки, который служит для выполнения различных запросов DNS (системы доменных имен). Вы можете использовать команду DIG, чтобы:
- Диагностика ваших серверов имен. Проверьте их все или каждый отдельный сервер и их ответ.
- Проверьте все доступные записи DNS или отдельные записи DNS и их параметры.
- Отслеживайте IP-адреса и смотрите имена хостов, которые им соответствуют.
- Выполните запрос через определенный порт, который вы хотите использовать.
- Посмотрите значение TTL записей DNS и узнайте, как часто они обновляются.
- Отслеживание маршрута DNS-запроса .
- 
Команда DIG, предустановленна в большинстве дистрибутивов Linux. Можно легко установить на macOS с помощью Brew и получить команду DIG в Windows 10 с помощью Bind9.

## Как это работает?

Команда DIG работает, выполняя DNS-запрос с вашего устройства к целевому IP-адресу или имени хоста. Запрос сначала поступит на рекурсивные серверы имен вашего интернет-провайдера. Если есть ваш ответ, он быстро его вернет. В противном случае ваш запрос будет перенаправлен в поисках ответа. Может быть другой рекурсивный DNS-сервер, который может ответить на запрос, или он может прийти к авторитетному DNS-серверу имен, который наверняка получит ответ, и вы получите разрешение вашего DNS-запроса.  

## Синтаксис команды DIG

Команда DIG (Domain Information Groper) — невероятно универсальный инструмент, используемый для запроса серверов системы доменных имен (DNS). Понимание его синтаксиса является ключом к раскрытию всего его потенциала. Общий формат команды DIG следующий:

dig [@server] [domain] [query-type] [options]
- @server : Это необязательно. Используйте его, чтобы указать DNS-сервер, который вы хотите запросить. Если этот параметр опущен, DIG использует сервер по умолчанию.
- domain : это доменное имя, о котором вы запрашиваете.
- query-type : указывает тип DNS-записи, которую вы хотите запросить (например, A, MX, NS). Если не указано, DIG по умолчанию запрашивает записи A.
- options : DIG предлагает различные варианты форматирования или фильтрации результатов запроса. Вот некоторые распространенные параметры, используемые с dig:
+short : Дает более короткий и краткий вывод.
+trace : отслеживает путь запроса в пространстве имен DNS.
+noall +ответ : показывает только часть ответа на запрос.

## Команды DIG

## Как узнать IP-адрес сайта?

Найдите IP-адрес определенного доменного имени, которое вы хотите знать. Вы можете использовать команду DIG без каких-либо дополнительных опций, а именно:
```
dig example.com
```
Он выполнит DNS-запрос в поисках записей A. У них есть IP-адреса, соответствующие доменному имени, из запроса.

Следующая команда dig также предоставит вам много дополнительной информации. Такие данные, как версия используемой вами команды DIG, заголовок, показывающий, что вы сделали и кто вам ответил, используемый порт и протокол (обычно UDP), время, необходимое для запроса, TTL записи и т. д. и сервер, который вам ответил.

Если вам не нужно так много информации, введите короткий ответ, указав только IP-адрес, с помощью этой команды:
```
dig +short example.com
```
Результатом будет только IP-адрес.


 ## Как найти серверы имен, отвечающие за ваш домен
 Просмотрите список всех серверов имен для конкретного домена. Мы будем искать записи NS и снова воспользуемся опцией +short, чтобы получить только серверы имен без дополнительных данных.
```
 dig NS example.com +short
```
```
ns1.example.com.

ns2.example.com.

ns3.example.com.

ns4.example.com.
```
Если один из NS серверов не отображается, это означает, что с ним возникли проблемы и вам необходимо будет устранить неполадку.

## Каков путь делегирования в вашу зону DNS

Вы можете сделать запрос трассировки и увидеть путь, начиная от корневого сервера до вашей зоны DNS.

Использовать опцию +trace.
```
dig example.com +trace
```
Output:
```
; <<>> DiG 9.9.5-3ubuntu0.7-Ubuntu <<>> example.com +trace
;; global options: +cmd
. 3493 IN NS a.root-servers.net.
. 3493 IN NS b.root-servers.net.
. 3493 IN NS c.root-servers.net.
. 3493 IN NS d.root-servers.net.
. 3493 IN NS e.root-servers.net.
. 3493 IN NS f.root-servers.net.
. 3493 IN NS g.root-servers.net.
. 3493 IN NS h.root-servers.net.
. 3493 IN NS i.root-servers.net.
. 3493 IN NS j.root-servers.net.
. 3493 IN NS k.root-servers.net.
. 3493 IN NS l.root-servers.net.
. 3493 IN NS m.root-servers.net.
;; Received 397 bytes from 127.0.1.1#53(127.0.1.1) in 466 ms
com. 172800 IN NS a.gtld-servers.net.
com. 172800 IN NS b.gtld-servers.net.
com. 172800 IN NS c.gtld-servers.net.
com. 172800 IN NS d.gtld-servers.net.
com. 172800 IN NS e.gtld-servers.net.
com. 172800 IN NS f.gtld-servers.net.
com. 172800 IN NS g.gtld-servers.net.
com. 172800 IN NS h.gtld-servers.net.
com. 172800 IN NS i.gtld-servers.net.
com. 172800 IN NS j.gtld-servers.net.
com. 172800 IN NS k.gtld-servers.net.
com. 172800 IN NS l.gtld-servers.net.
com. 172800 IN NS m.gtld-servers.net.
;; Received 734 bytes from 192.203.230.10#53(e.root-servers.net) in 496 ms
example.com. 172800 IN NS ns2.example.com.
example.com. 172800 IN NS ns1.example.com.
example.com. 172800 IN NS ns3.example.com.
example.com. 172800 IN NS ns4.example.com.
;; Received 660 bytes from 192.55.83.30#53(m.gtld-servers.net) in 229 ms
example.com. 300 IN A 1.2.3.4
example.com. 300 IN NS ns1.example.com
example.com. 300 IN NS ns2.example.com
example.com. 300 IN NS ns3.example.com
example.com. 300 IN NS ns4.example.com
;; Received 44 bytes from 216.239.34.10#53(ns2.example.com) in 40 ms

```
Ответ покажет вам маршрут, по которому проходит типичный DNS-запрос. Можете увидеть прыжки и обнаружить проблему, а также узнать, где именно теряются запросы.

## Какой почтовый сервер отвечает за ваш домен

Проверьте ответственные почтовые серверы на предмет приема писем.
```
dig MX example.com +short
```
Output:
```
1 ASPMX.L.GOOGLE.COM.

5 ALT1.ASPMX.L.GOOGLE.COM.

5 ALT2.ASPMX.L.GOOGLE.COM.

10 ALT3.ASPMX.L.GOOGLE.COM.

10 ALT4.ASPMX.L.GOOGLE.COM.
```
Этот запрос будет направлен к записям MX. Внутри них мы хотим увидеть, отображаются ли все почтовые серверы и правильно ли указаны записи MX.

## С каким IP-адресом связано доменное имя

Обратная проверка DNS, IP-адрес по имени хоста. Вы также можете выполнить обратную проверку DNS и посмотреть, какому имени хоста принадлежит IP-адрес. Для этого владельцу домена необходимо иметь DNS-записи PTR с правильно указанным IP-адресом.
```
dig -x 1.2.3.4
```
## Какие серверы имен отвечают за TLD (домены верхнего уровня)

Посмотрите серверы имен, их список, для TLD, который вы указали в запросе. Да, вы также можете сделать это и проверить серверы имен домена верхнего уровня, например COM, EU, US, ASIA или другого.

Команда dig будет аналогична предыдущей, но вместо полного доменного имени мы будем просто указывать TLD.
```
dig NS com +short
```
Output:
```
j.gtld-servers.net.
a.gtld-servers.net.
i.gtld-servers.net.
d.gtld-servers.net.
f.gtld-servers.net.
b.gtld-servers.net.
h.gtld-servers.net.
e.gtld-servers.net.
m.gtld-servers.net.
k.gtld-servers.net.
c.gtld-servers.net.
g.gtld-servers.net.
l.gtld-servers.net.
```
## Как проверить, синхронизирована ли ваша DNS-зона со всеми авторитетными серверами имен
```
dig example.com +nssearch
```
Output:

```
SOA ns1.example.com. dns-admin.example.com. 2016042102 7200 1800 1209600 300 from server ns3.example.com in 14 ms.

SOA ns1.example.com. dns-admin.example.com. 2016042102 7200 1800 1209600 300 from server ns2.example.com in 22 ms.

SOA ns1.example.com. dns-admin.example.com. 2016042102 7200 1800 1209600 300 from server ns4.example.com in 88 ms.

SOA ns1.example.com. dns-admin.example.com. 2016042102 7200 1800 1209600 300 from server ns1.example.com in 125 ms.
```
Проверьте, синхронизирована ли ваша зона DNS на всех авторитетных серверах имен. Это способ проверить записи SOA и посмотреть, совпадают ли их данные. Если ваши зоны DNS не синхронизированы, вам придется управлять ими и обновлять их вручную. 

## Как проверить, когда истечет срок действия кеша ответа?

Посмотреть, когда истечет срок действия кэша с ответом.
```
dig example.com +noall +answer
```
Output:
```
;; global options: +cmd

example.com. 109 IN A 1.2.3.4

example.com. 109 IN A 1.2.3.4;; ->>HEADERexample.com. 109 IN A 1.2.3.4

example.com. 109 IN A 1.2.3.4
```
Дополнительные параметры удалят ненужную информацию и просто покажут нужный нам ответ — значение TTL для записи A. Это значение представляет время в секундах и показывает, как долго оно остается действительным.
## Как проверить, существует ли зона на DNS-сервере

Посмотреть, существует ли зона на конкретном сервере имен. Снова увидеть запись SOA, но укажем символом «@», на каком сервере имен мы ее ищем. В данном случае сервером имен является «ns1.example.com».
```
dig SOA example.com @ns1.example.com 
```
Получите один из трех результатов:

- NOERROR – да, зона существует.
- NXDOMAIN – нет, это не так.
- REFUSED – сервер имен не хочет отвечать.

## Как проверить, какое значение находится в кеше данного резолвера (resolver)

Проверьте, что конкретное преобразователь имеет в своей кэш-памяти. Мы воспользуемся преобразователем DNS Google (8.8.8.8), чтобы увидеть, что он имеет для нашего доменного имени.
```
dig example.com @8.8.8.8
```
Output:
```
;; global options: +cmd

;; Got answer:

;; ->>HEADER<;; flags: qr rd ra; QUERY: 1, ANSWER: 6, AUTHORITY: 0, ADDITIONAL: 0

;; QUESTION SECTION:

;google.com. IN A

;; ANSWER SECTION:

example.com. 300 IN A 1.2.3.4

example.com. 300 IN A 1.2.3.4

example.com. 300 IN A 1.2.3.4

example.com. 300 IN A 1.2.3.4

example.com. 300 IN A 1.2.3.4

example.com. 300 IN A 1.2.3.4
```
Вы увидите записи A с их значениями.
